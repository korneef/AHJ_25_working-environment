container:
  image: node:latest

# test_task:
#   name: Tests
#   node_modules_cache:
#     folder: node_modules
#     ingerprint_script: cat package-lock.json
#     populate_script: npm ci
#   test_script: npm run lint && npm test


deploy_task:
  only_if: $CIRRUS_BRANCH == 'master'
  # depends_on: Tests
  node_modules_cache:
    folder: node_modules
    ingerprint_script: cat package-lock.json
    populate_script: npm ci
  environment:
    AUTH_TOKEN: ENCRYPTED[1b897378ed3f743b0883944cbd3f1977e1d746dc5b5296a32db793ea8ad1c14b21c2990ddd30f91374b38cb73445665b]
  deploy_script: 
    - git config --global user.name "Cirrus-CI"
    - git config --global user.email "ci@cirruslabs.org"
    - echo "https://$GITHUB_TOKEN:x-oauth-basic@github.com" > "$HOME/.git-credentials"
    - npm run build && npx push-dir --dir=dist --branch=gh-pages --force --verbose
